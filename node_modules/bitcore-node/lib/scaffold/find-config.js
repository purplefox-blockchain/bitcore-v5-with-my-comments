'use strict';

var bitcore = require('bitcore-lib');
var $ = bitcore.util.preconditions;
var _ = bitcore.deps._;
var path = require('path');
var fs = require('fs');
var utils = require('../utils');

var index = require('../');
var log = index.log;

/**
 * Will return the path and bitcore-node configuration
 * @param {String} cwd - The absolute path to the current working directory
 */
function findConfig(cwd) {

  log.info('scaffold/find-config.js starts');

  $.checkArgument(_.isString(cwd), 'Argument should be a string');
  $.checkArgument(utils.isAbsolutePath(cwd), 'Argument should be an absolute path');
  var directory = String(cwd);
  log.info('findConfig start searching from '+directory+' dir by dir upwards till /root');
  while (!fs.existsSync(path.resolve(directory, 'bitcore-node.json'))) {
    directory = path.resolve(directory, '../');
    log.info('searching '+directory);
    if (directory === '/') {
      log.info('going to return false in findConfig()');
      return false;
    }
  }
  //since we found the file in the directory
  //we are going to require the bitcore-node.json in that directory and make it 'config'
  return {
    path: directory,
    config: require(path.resolve(directory, 'bitcore-node.json'))
  };
}

module.exports = findConfig;
